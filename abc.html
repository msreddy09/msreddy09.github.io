<!DOCTYPE html>
<html lang="en">

<head>
  <title>The M Loan</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    table,
    th,
    td {
      border: none;
      border-collapse: collapse;
      padding: 2px 3px;
      text-align: center;

    }

    table tr:nth-child(even) td {
      background: #eee;
    }

    th {
      font-weight: bold;
    }

    table {
      width: 100%;
    }

    .dashboarditem {
      padding: 16px 12px;
      display: flex;
      flex-direction: column;
      text-align: center;
      color: white;
      width: 33.33%;


    }

    .dashboarditem div:first-child {
      font-size: 12px;

    }

    .dashboarditem div:last-child {
      font-size: 14px;
      font-weight: bold;

    }

    #showData {
      display: block;

    }

    .dashboard {
      display: flex;
      justify-content: space-between;
      margin-bottom: 10px;

    }

    #totalAmount {
      background: #28a745 !important;

    }

    #interest {
      background: #ffc107 !important;

    }

    #principle {
      background: #17a2b8 !important;
    }

    th {
      background: #007bff !important;
      color: white;
    }

    .card {

      background: #ccc;
      border: 1px solid;
      margin: 10px 0;
    }

    .card-header {
      padding: 4px 10px;
      display: flex;
      justify-content: space-between;
      background: #1562c1;
      color: white;
    }

    .card-body {
      padding: 10px;
      display: none;
    }

    #monthlyR {
      display: flex;
      flex-direction: row;
      background: #7BC;
      justify-content: space-between;
      padding: 10px;
      font-weight: bold;
      color: #FFF;
    }
  </style>
</head>

<body>
  <div class='dashboard'>
    <div class='dashboarditem' id='principle'></div>
    <div class='dashboarditem' id='interest'></div>
    <div class='dashboarditem' id='totalAmount'></div>
  </div>
  <div id="monthlyR"></div>
  <div style="margin-top: 10px;">
    Sort By:
    <button onclick="sortData('date')"> Date</button>
    <button onclick="sortData('amount')">Amount</button>
    <button onclick="sortData('name')">Name</button>
  </div>

  <div id='showData'></div>


  <script type='text/javascript'>

    let defaultSort = {
      sortType: 'date',
      sortbyDesc: false
    }

    let givenAmounts = [{
      Name: 'Ayineedu',
      p: 200000.00,
      i: 1.5,
      gd: '11/16/2022',
      it: 0,
      s: true,
      time: ''
    },{
      Name: 'Alugundla Venka Reddy',
      p: 200000.00,
      i: 1.5,
      gd: '12/24/2022',
      it: 0,
      s: true,
      time: ''
    },
    
    {
      Name: 'Gudi Venkateswarlu',
      p: 60000.00,
      i: 1.5,
      gd: '7/7/2022',
      it: 0,
      s: true,
      time: ''
    },
    {
      Name: 'Aadireddy Subba Reddy',
      p: 500000.00,
      i: 1.5,
      gd: '8/13/2022',
      it: 0,
      s: true,
      time: ''
    },
    {
      Name: 'Narayana',
      p: 50000.00,
      i: 1.5,
      gd: '8/3/2022',
      it: 0,
      s: true,
      time: ''
    },
    {
      Name: 'Rayudu',
      p: 500000.00,
      i: 1.5,
      gd: '1/25/2021',
      it: 0,
      s: true,
      time: ''
    },
    {
      Name: 'Mukkasi',
      p: 40000.00,
      i: 2,
      gd: '10/13/2021',
      it: 0,
      s: true,
      time: ''
    },
    {
      Name: 'Raja Gopal Reddy Maram',
      p: 1000000.00,
      i: 1.5,
      gd: '11/1/2021',
      it: 0,
      s: true,
      time: ''
    },
    {
      Name: 'BB',
      p: 100000.00,
      i: 1.5,
      gd: '3/3/2020',
      it: 0,
      s: true,
      time: ''
    },
    {
      Name: 'Bakka Bava',
      p: 300000.00,
      i: 1.5,
      gd: '4/15/2022',
      it: 0,
      s: true,
      time: ''
    },
    {
      Name: 'Raja Reddy Sravani',
      p: 95000.00,
      i: 1.5,
      gd: '08/06/2022',
      it: 0,
      s: true,
      time: ''
    },
    {
      Name: 'Chinna Annayya',
      p: 100000.00,
      i: 1,
      gd: '11/05/2022',
      it: 0,
      s: true,
      time: ''
    },
    {
      Name: 'Nayudu Palem',
      p: 200000.00,
      i: 1.5,
      gd: '11/15/2022',
      it: 0,
      s: true,
      time: ''
    }
    ]

    const getDateDifference = (fd, td = new Date(new Date().setDate(new Date().getDate() - 1))) => {
      const date1 = new Date(fd);
      const date2 = new Date(td);
      const diffTime = Math.abs(date2 - date1);

      const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
      return {
        inDays: 0,
        inMonths: 0,
        inYears: 0,
        totalDays: diffDays
      }

    }

    const calCulateInterestAmount = (ga) => {

      const timePassed = getDateDifference(ga.gd);
      const totalDays = timePassed.totalDays;
      const interestPerDay = ((ga.p * ga.i) / 100) / 30;
      const years = Math.floor(totalDays / 365);
      const months = Math.floor((totalDays - years * 365) / 30);
      const days = Math.floor((totalDays - years * 365) % 30);
      const yearsInt = years * (ga.i / 100 * ga.p) * 12;
      const monthsInt = months * (ga.i / 100 * ga.p)
      const daysInt = days * interestPerDay
      const totalInterest = yearsInt + monthsInt + daysInt
      ga.time = years + " Years " + months + " Months " + days + " days";
      return Math.round(totalInterest);

    }

    let tableFromJson = (sortObj) => {

      const table = document.createElement("div");
      let t = '';

      if (sortObj) {
        if (sortObj.sortType === 'date') {
          givenAmounts.sort((a, b) => {
            var dateA = new Date(a.gd);
            var dateB = new Date(b.gd);
            return sortObj.sortbyDesc ? dateA - dateB : dateB - dateA;
          });
        }
        if (sortObj.sortType === 'amount') {
          givenAmounts.sort((a, b) => {
            return sortObj.sortbyDesc ? (a.p + a.it) - (b.p + b.it) : (b.p + b.it) - (a.p + a.it);
          });
        }
        if (sortObj.sortType === 'name') {
          function compareAsc(a, b) {
            if (a.Name < b.Name) {
              return -1;
            }
            if (a.Name > b.Name) {
              return 1;
            }
            return 0;
          }

          function compareDesc(a, b) {
            if (a.Name < b.Name) {
              return 1;
            }
            if (a.Name > b.Name) {
              return -1;
            }
            return 0;
          }

          if (defaultSort.sortbyDesc) {
            givenAmounts.sort(compareDesc);
          } else {
            givenAmounts.sort(compareAsc);
          }
        }
      }

      for (let i = 0; i < givenAmounts.length; i++) {
        let ta = givenAmounts[i].p + givenAmounts[i].it;
        t += `<div class='card'>
			   <div class='card-header' onclick='handleAccordian(event)'> 
				  <div>${givenAmounts[i].Name}</div> 
				  <div> Rs. ${ta.toFixed(2)}</div> 				  
			   </div>
			  <div class='card-body'> 
          <div> Given on: ${givenAmounts[i].gd}</div> 
				  <div> Duration: ${givenAmounts[i].time}</div> 				  
				  <div style="display: flex;justify-content: space-between; margin: 6px 0">
						<div><div>Principle </div>Rs. ${givenAmounts[i].p.toFixed(2)}</div>  
						<div><div>Interest</div>Rs. ${givenAmounts[i].it.toFixed(2)}</div> 
						<div><div>Interest Rate </div> ${givenAmounts[i].i.toFixed(2)}%</div> 
				  </div>
			  </div>
	  
	  </div>`
      }
      const divShowData = document.getElementById('showData');
      divShowData.innerHTML = t;
    }

    const handleAccordian = (e) => {
      e.stopPropagation();
      const curentEle = e.currentTarget.parentElement.children[1];
      if (curentEle.style.display === 'none' || curentEle.style.display === '') {
        curentEle.style.display = 'block'
      } else {
        curentEle.style.display = 'none'
      }
    }

    const getAllInterests = () => {

      givenAmounts.map((ga, ind) => {

        let givenAmountObj = { ...ga };
        ga.it = calCulateInterestAmount(ga)

        return ga;
      })

      tableFromJson(defaultSort);
    }

    const updateTotalAmount = () => {

      const total = givenAmounts.reduce((sum, a) => {
        return sum + a.it + a.p;
      }, 0)

      totalAmount.innerHTML = `<div>Total</div><div>Rs. ${total.toFixed(2)}</div>`;

    }

    const updatePrincipleAmount = () => {

      const total = givenAmounts.reduce((sum, a) => {
        return sum + a.p
      }, 0)

      principle.innerHTML = `<div>Principle</div><div>Rs. ${total.toFixed(2)}</div>`;

    }

    const updateIntersets = () => {
      const total = givenAmounts.reduce((sum, a) => {
        return sum + (a.it)
      }, 0)

      interest.innerHTML = `<div>Interest</div><div>Rs. ${total.toFixed(2)}</div>`;
    }

    const mothlyReceivables = () => {
      const total = givenAmounts.reduce((sum, a) => {
        return sum + (a.p * a.i / 100)
      }, 0)
      monthlyR.innerHTML = `<div>Monthly Receivables</div><div>Rs. ${total.toFixed(2)}</div>`;;
    }

    const sortData = (type) => {

      if (type === 'date') {
        defaultSort.sortType = 'date'

      }
      if (type === 'name') {
        defaultSort.sortType = 'name'
      }
      if (type === 'amount') {
        defaultSort.sortType = 'amount'
      }
      defaultSort.sortbyDesc = !defaultSort.sortbyDesc
      tableFromJson(defaultSort)
    }
    getAllInterests();
    updateTotalAmount();
    updatePrincipleAmount();
    updateIntersets();
    mothlyReceivables()


  </script>

  <body>

</html>
